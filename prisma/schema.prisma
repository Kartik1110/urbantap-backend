generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String        @id @default(uuid())
  email              String        @unique
  password           String
  name               String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  role               Role
  googleAccessToken  String?
  googleId           String?       @unique
  googleRefreshToken String?
  appleAccessToken   String?
  appleId            String?       @unique
  appleRefreshToken  String?
  w_number           String?
  country_code       String?
  fcm_token          String?
  applications       Application[]
  brokers            Broker[]
  jobs               Job[]
}

model Broker {
  id                       String              @id @default(uuid())
  name                     String
  email                    String              @unique
  info                     String
  y_o_e                    Int
  languages                String[]
  is_certified             Boolean
  profile_pic              String
  w_number                 String
  ig_link                  String?
  linkedin_link            String?
  company_id               String?
  user_id                  String?
  designation              String?
  country_code             String?
  type                     BrokerType?
  brokerageId              String?
  developerId              String?
  specialities             Speciality[]        @default([])
  Brokerage                Brokerage?          @relation(fields: [brokerageId], references: [id])
  company                  Company?            @relation(fields: [company_id], references: [id])
  Developer                Developer?          @relation(fields: [developerId], references: [id])
  user                     User?               @relation(fields: [user_id], references: [id])
  sentByConnectionRequests ConnectionRequest[] @relation("SentBy")
  sentToConnectionRequests ConnectionRequest[] @relation("SentTo")
  broker1Connections       Connections[]       @relation("Broker1")
  broker2Connections       Connections[]       @relation("Broker2")
  sentByInquiries          Inquiry[]           @relation("InquirySentBy")
  sentToInquiries          Inquiry[]           @relation("InquirySentTo")
  listings                 Listing[]
  notifications            Notification[]
  reportedListings         ReportedListing[]
}

model Company {
  id          String        @id @default(uuid())
  name        String        @default("")
  description String        @default("")
  logo        String        @default("")
  address     String?       @default("")
  email       String?       @default("")
  name_ar     String?
  phone       String?       @default("")
  type        CompanyType   @default(Other)
  website     String?       @default("")
  brokerageId String?       @unique
  developerId String?       @unique
  AdminUser   AdminUser[]
  brokers     Broker[]
  brokerage   Brokerage?    @relation("CompanyToBrokerage", fields: [brokerageId], references: [id])
  developer   Developer?    @relation("CompanyToDeveloper", fields: [developerId], references: [id])
  CompanyPost CompanyPost[]
  jobs        Job[]
}

model Listing {
  id                    String            @id @default(uuid())
  title                 String
  description           String
  image                 String
  broker_id             String
  address               String?           @default("")
  amenities             String[]
  category              Category
  city                  City
  furnished             Furnished?
  image_urls            String[]
  looking_for           Boolean
  max_price             Float?            @default(0)
  min_price             Float?            @default(0)
  rental_frequency      Rental_frequency?
  type                  Type
  created_at            DateTime          @default(now())
  sq_ft                 Float?
  no_of_bathrooms       Bathrooms?
  no_of_bedrooms        Bedrooms?
  payment_plan          Payment_Plan?
  sale_type             Sale_Type?
  project_age           Int?
  admin_status          Admin_Status?     @default(Pending)
  latitude              Float?
  longitude             Float?
  cheques               Int?
  construction_progress Int?
  floor_area_ratio      Float?
  gfa_bua               Int?
  parking_space         Boolean?
  service_charge        Int?
  current_status        CurrentStatus?
  deal_type             DealType?
  handover_quarter      Quarter?
  handover_year         Int?
  market                Market?
  type_of_use           Type_of_use?
  views                 Views?
  locality              String?
  brokerage_id          String?
  inquiries             Inquiry[]
  broker                Broker            @relation(fields: [broker_id], references: [id])
  brokerage             Brokerage?        @relation("BrokerageListings", fields: [brokerage_id], references: [id])
  listing_views         ListingView?
  notifications         Notification[]    @relation("ListingNotifications")
  reported_listings     ReportedListing[]
}

model ListingView {
  id         String   @id @default(uuid())
  listing_id String   @unique
  viewed_at  DateTime @default(now())
  count      Int      @default(1)
  listing    Listing  @relation(fields: [listing_id], references: [id])
}

model AdminUser {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  companyId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  company   Company  @relation(fields: [companyId], references: [id])
  Job       Job[]
}

model Developer {
  id          String    @id @default(uuid())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  cover_image String?
  company_id  String
  Broker      Broker[]
  company     Company?  @relation("CompanyToDeveloper")
  projects    Project[]
}

model Project {
  id              String       @id @default(uuid())
  title           String
  description     String
  image           String
  images          String[]
  price           Float
  address         String
  city            City
  file_url        String?
  type            Category
  amenities       String[]
  created_at      DateTime     @default(now())
  developer_id    String
  floor_plans     String[]
  furnished       Furnished
  no_of_bathrooms Bathrooms
  no_of_bedrooms  Bedrooms
  payment_plan    Payment_Plan
  project_age     String
  project_name    String
  property_size   Float
  unit_types      String[]
  updated_at      DateTime     @updatedAt
  currency        Currency
  developer       Developer    @relation(fields: [developer_id], references: [id])
}

model Brokerage {
  id            String    @id @default(uuid())
  ded           String?
  rera          String?
  service_areas String[]
  company_id    String
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt
  about         String?
  brokers       Broker[]
  company       Company?  @relation("CompanyToBrokerage")
  listings      Listing[] @relation("BrokerageListings")
}

model CompanyPost {
  id         String       @id @default(uuid())
  title      String?
  caption    String?
  company_id String
  created_at DateTime     @default(now())
  updated_at DateTime     @updatedAt
  images     String[]     @default([])
  position   PostPosition @default(Home)
  rank       Int          @default(1)
  company    Company      @relation(fields: [company_id], references: [id])
}

model ReportedListing {
  id             String   @id @default(uuid())
  listing_id     String
  reported_by_id String
  reason         String
  description    String
  created_at     DateTime @default(now())
  listing        Listing  @relation(fields: [listing_id], references: [id])
  reported_by    Broker   @relation(fields: [reported_by_id], references: [id])
}

model Notification {
  id                   String             @id @default(uuid())
  broker_id            String
  timestamp            DateTime           @default(now())
  text                 String
  type                 NotificationType
  inquiry_id           String?
  connectionRequest_id String?
  message              String?
  sent_by_id           String
  listing_id           String?
  broker               Broker             @relation(fields: [broker_id], references: [id])
  connectionRequest    ConnectionRequest? @relation("ConnectionRequestNotifications", fields: [connectionRequest_id], references: [id])
  inquiry              Inquiry?           @relation("InquiryNotifications", fields: [inquiry_id], references: [id])
  listing              Listing?           @relation("ListingNotifications", fields: [listing_id], references: [id])
}

model ConnectionRequest {
  id            String         @id @default(uuid())
  sent_by_id    String
  sent_to_id    String
  timestamp     DateTime       @default(now())
  status        RequestStatus
  text          String?
  sent_by       Broker         @relation("SentBy", fields: [sent_by_id], references: [id])
  sent_to       Broker         @relation("SentTo", fields: [sent_to_id], references: [id])
  notifications Notification[] @relation("ConnectionRequestNotifications")
}

model Connections {
  id         String   @id @default(uuid())
  broker1_id String
  broker2_id String
  timestamp  DateTime @default(now())
  broker1    Broker   @relation("Broker1", fields: [broker1_id], references: [id])
  broker2    Broker   @relation("Broker2", fields: [broker2_id], references: [id])
}

model Inquiry {
  id            String         @id @default(uuid())
  sent_by_id    String
  sent_to_id    String
  timestamp     DateTime       @default(now())
  listing_id    String
  text          String
  email         String
  name          String
  phone_no      String
  country_code  String
  listing       Listing        @relation(fields: [listing_id], references: [id], onDelete: Cascade)
  sent_by       Broker         @relation("InquirySentBy", fields: [sent_by_id], references: [id])
  sent_to       Broker         @relation("InquirySentTo", fields: [sent_to_id], references: [id])
  notifications Notification[] @relation("InquiryNotifications")
}

model Job {
  id             String        @id @default(uuid())
  title          String
  location       String
  description    String
  userId         String?
  currency       Currency
  max_experience Int?
  max_salary     Float?
  min_experience Int?
  min_salary     Float?
  company_id     String
  job_type       JobType
  workplace_type WorkplaceType
  skills         String?
  adminUserId    String?
  created_at     DateTime      @default(now())
  updated_at     DateTime?     @updatedAt
  applications   Application[]
  adminUser      AdminUser?    @relation(fields: [adminUserId], references: [id])
  company        Company       @relation(fields: [company_id], references: [id])
  user           User?         @relation(fields: [userId], references: [id])
}

model Application {
  id         String            @id @default(uuid())
  resume     String
  status     ApplicationStatus @default(Under_Review)
  created_at DateTime          @default(now())
  job_id     String
  updated_at DateTime          @updatedAt
  user_id    String
  job        Job               @relation(fields: [job_id], references: [id])
  user       User              @relation(fields: [user_id], references: [id])
}

enum Role {
  BROKER
  OTHER
  ADMIN
  HR
  SM
}

enum Speciality {
  Villa
  Apartment
  Townhouse
  Office
  Shop
}

enum BrokerType {
  Off_plan
  Ready_to_move
  Both
}

enum CompanyType {
  Developer
  Brokerage
  Other
}

enum Type_of_use {
  Commercial
  Residential
  Mixed
}

enum Quarter {
  Q1
  Q2
  Q3
  Q4
}

enum DealType {
  Rental
  Selling
}

enum CurrentStatus {
  Occupied
  Vacant
}

enum Views {
  Classic
  City
  Community
  Water
  Sea
  Canal
  Park
  Lagoon
  Golf_Course
  Others
}

enum Market {
  Primary
  Secondary
}

enum Admin_Status {
  Approved
  Rejected
  Pending
  Reported
}

enum Category {
  Ready_to_move
  Off_plan
  Rent
}

enum Type {
  Apartment
  Villa
  Townhouse
  Office
  Shop
  Plot
  Retail
  Warehouse
}

enum Rental_frequency {
  Monthly
  Quarterly
  Yearly
  Lease
}

enum Furnished {
  Furnished
  Semi_furnished
  Unfurnished
  Kitchen_Appliances_only
}

enum City {
  Dubai
  Abu_Dhabi
  Sharjah
  Ajman
  Ras_Al_Khaimah
  Fujairah
  Umm_Al_Quwain
}

enum Bedrooms {
  Studio
  One
  Two
  Three
  Four_Plus
}

enum Bathrooms {
  One
  Two
  Three_Plus
}

enum Payment_Plan {
  Payment_done
  Payment_Pending
}

enum Sale_Type {
  Direct
  Resale
}

enum PostPosition {
  Home
  Listings
  Jobs
}

enum NotificationType {
  General
  Inquiries
  Network
  Broadcast
}

enum RequestStatus {
  Accepted
  Rejected
  Pending
  Blocked
}

enum Currency {
  USD
  AED
  INR
}

enum WorkplaceType {
  On_site
  Remote
  Hybrid
}

enum JobType {
  Full_time
  Part_time
  Internship
  Contract
}

enum ApplicationStatus {
  Under_Review
  Accepted
  Rejected
}
